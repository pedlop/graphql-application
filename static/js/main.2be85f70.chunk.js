(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(e,t,n){e.exports=n(62)},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),l=n(17),o=n.n(l),r=(n(30),n(5)),c=n(6),s=n(8),u=n(7),m=n(9),d=n(12),h=n(11),E=i.a.createContext({token:null,userId:null,login:function(e,t,n){},logout:function(){}}),p=(n(31),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={isLogin:!0},n.switchModeHandler=function(){n.setState(function(e){return{isLogin:!e.isLogin}})},n.submitHandler=function(e){e.preventDefault();var t=n.emailElement.current.value,a=n.passwordElement.current.value;if(0!==t.trim().length&&0!==a.trim().length){var i={query:"\n        query Login($email: String!, $password: String!) {\n          login(email: $email, password: $password) {\n            userId\n            token\n            tokenExpiration\n          }\n        }\n      ",variables:{email:t,password:a}};n.state.isLogin||(i={query:"\n          mutation CreateUser($email: String!, $password: String!) {\n            createUser(userInput: { email: $email, password: $password }) {\n              _id\n              email\n            }\n          }\n        ",variables:{email:t,password:a}}),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){e.data.login.token&&n.context.login(e.data.login.token,e.data.login.userId,e.data.login.tokenExpiration)}).catch(function(e){console.log(e)})}},n.emailElement=i.a.createRef(),n.passwordElement=i.a.createRef(),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"email"},"Email"),i.a.createElement("input",{type:"email",id:"email",ref:this.emailElement})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"password"},"Password"),i.a.createElement("input",{type:"password",id:"password",ref:this.passwordElement})),i.a.createElement("div",{className:"form-actions"},i.a.createElement("button",{type:"button",onClick:this.switchModeHandler},"Switch to ",this.state.isLogin?"Signup":"Login"),i.a.createElement("button",{type:"submit"},"Submit")))}}]),t}(a.Component));p.contextType=E;var f=p,v=(n(32),function(e){return i.a.createElement("ul",{className:"bookings__list"},e.bookings.map(function(t){return i.a.createElement("li",{key:t._id,className:"bookings__item"},i.a.createElement("div",{className:"bookinkgs__item-data"},t.event.title," - "," ",new Date(t.createdAt).toLocaleDateString("pt-BR")),i.a.createElement("div",{className:"bookinkgs__item-actions"},i.a.createElement("button",{className:"btn",onClick:e.onDelete.bind(void 0,t._id)},"Cancel")))}))}),g=n(14),b=n(22),k={Cheap:{min:0,max:100},Normal:{min:100,max:200},Expensive:{min:200,max:1e7}},y=function(e){var t={labels:[],datasets:[]},n=[],a=function(a){var i=e.bookings.reduce(function(e,t){return t.event.price>k[a].min&&t.event.price<k[a].max?e+1:e},0);n.push(i),t.labels.push(a),t.datasets.push({fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:n}),(n=Object(g.a)(n))[n.length-1]=0};for(var l in k)a(l);return i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(b.Bar,{data:t}))},C=(n(45),function(e){return i.a.createElement("div",{className:"bookings-control"},i.a.createElement("button",{className:"list"===e.activeOutputType?"active":"",onClick:e.onChange.bind(void 0,"list")},"List"),i.a.createElement("button",{className:"chart"===e.activeOutputType?"active":"",onClick:e.onChange.bind(void 0,"chart")},"Chart"))}),S=(n(46),function(){return i.a.createElement("div",{className:"plop-loading"},i.a.createElement("div",{className:"plop-spinner"},i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null)))}),w=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={bookings:[],loading:!1,outputType:"list"},n.fetchBookings=function(){n.setState({loading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n        query {\n          bookings {\n            _id\n            createdAt\n            event {\n              _id\n              title\n              date\n              price\n            }\n          }\n        }\n      "}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.context.token)}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){var t=e.data.bookings;n.setState({bookings:t,loading:!1})}).catch(function(e){console.log(e),n.setState({loading:!1})})},n.deleteBookingHandler=function(e){n.setState({loading:!0});var t={query:"\n        mutation CancelBooking($id: ID!) {\n          cancelBooking(bookingId: $id) {\n            _id\n            title\n          }\n        }\n      ",variables:{id:e}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.context.token)}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(t){n.setState(function(t){return{bookings:t.bookings.filter(function(t){return t._id!==e}),loading:!1}})}).catch(function(e){console.log(e),n.setState({loading:!1})})},n.changeOutputTypeHandler=function(e){"list"===e?n.setState({outputType:e}):n.setState({outputType:"chart"})},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"render",value:function(){var e=i.a.createElement(S,null);return this.state.loading||(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(C,{activeOutputType:this.state.outputType,onChange:this.changeOutputTypeHandler}),i.a.createElement("div",null,"list"===this.state.outputType?i.a.createElement(v,{bookings:this.state.bookings,onDelete:this.deleteBookingHandler}):i.a.createElement(y,{bookings:this.state.bookings})))),i.a.createElement(i.a.Fragment,null,e)}}]),t}(a.Component);w.contextType=E;var N=w,_=(n(47),function(e){return i.a.createElement("div",{className:"modal"},i.a.createElement("header",{className:"modal__header"},i.a.createElement("h1",null,e.title)),i.a.createElement("section",{className:"modal__content"},e.children),i.a.createElement("section",{className:"modal__actions"},e.canCancel&&i.a.createElement("button",{className:"btn",onClick:e.onCancel},"Cancel"),e.canConfirm&&i.a.createElement("button",{className:"btn",onClick:e.onConfirm},e.confirmText)))}),O=(n(48),function(e){return i.a.createElement("div",{className:"backdrop"})}),j=(n(49),function(e){return i.a.createElement("li",{key:e.eventId,className:"events__list-item"},i.a.createElement("div",null,i.a.createElement("h1",null,e.title),i.a.createElement("h2",null,"R$ ",e.price.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})," - ",new Date(e.date).toLocaleDateString("pt-BR"))),i.a.createElement("div",null,e.userId===e.creatorId?i.a.createElement("p",null,"Your the owner of this event."):i.a.createElement("button",{className:"btn",onClick:e.onDetail.bind(void 0,e.eventId)},"View Details")))}),x=(n(50),function(e){var t=e.events.map(function(t){return i.a.createElement(j,{key:t._id,eventId:t._id,title:t.title,price:t.price,date:t.date,userId:e.authUserId,creatorId:t.creator._id,onDetail:e.onViewDetail})});return i.a.createElement("ul",{className:"event__list"},t)}),T=(n(51),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={creating:!1,events:[],loading:!1,selectedEvent:null},n.isActive=!0,n.startCreateEventHandler=function(){n.setState({creating:!0})},n.modalConfirmHandler=function(){var e=n.titleElementRef.current.value,t=+n.priceElementRef.current.value,a=n.dateElementRef.current.value,i=n.descriptionElementRef.current.value;if(!(0===e.trim().length||t<=0||0===a.trim().length||0===i.trim().length)){var l={query:"\n        mutation CreateEvent($title: String!, $description: String!, $price: Float!, $date: String!) {\n          createEvent(eventInput: { title: $title, description: $description, price: $price, date: $date }) {\n            _id\n            title\n            description\n            price\n            date\n          }\n        }\n      ",variables:{title:e,description:i,price:t,date:a}},o=n.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){n.setState(function(t){var a=Object(g.a)(t.events);return a.push({_id:e.data.createEvent._id,title:e.data.createEvent.title,description:e.data.createEvent.description,price:e.data.createEvent.price,date:e.data.createEvent.date,creator:{_id:n.context.userId}}),{events:a}}),n.setState({creating:!1})}).catch(function(e){console.log(e)})}},n.modalCancelHandler=function(){n.setState({creating:!1,selectedEvent:null})},n.showDetailHandler=function(e){n.setState(function(t){return{selectedEvent:t.events.find(function(t){return t._id===e})}})},n.bookEventHandler=function(){var e=n.context.token;if(e){var t={query:"\n        mutation BookEvent($id: ID!) {\n          bookEvent(eventId: $id) {\n            _id\n            createdAt\n            updatedAt\n          }\n        }\n      ",variables:{id:n.state.selectedEvent._id}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){n.setState({selectedEvent:null})}).catch(function(e){console.log(e)})}else n.setState({selectedEvent:null})},n.titleElementRef=i.a.createRef(),n.priceElementRef=i.a.createRef(),n.dateElementRef=i.a.createRef(),n.descriptionElementRef=i.a.createRef(),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.fecthEvents()}},{key:"fecthEvents",value:function(){var e=this;this.setState({loading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n        query {\n          events {\n            _id\n            title\n            description\n            price\n            date\n            creator {\n              _id\n              email\n            }\n          }\n        }\n      "}),headers:{"Content-Type":"application/json"}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(t){var n=t.data.events;e.isActive&&e.setState({events:n,loading:!1})}).catch(function(t){console.log(t),e.isActive&&e.setState({loading:!1})})}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&i.a.createElement(O,null),this.state.creating&&i.a.createElement(_,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm"},i.a.createElement("form",null,i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"title"},"Title"),i.a.createElement("input",{type:"text",id:"title",ref:this.titleElementRef})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"price"},"Price"),i.a.createElement("input",{type:"number",id:"price",ref:this.priceElementRef})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"date"},"Date"),i.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateElementRef})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"description"},"Description"),i.a.createElement("textarea",{id:"description",rows:"4",ref:this.descriptionElementRef})))),this.state.selectedEvent&&i.a.createElement(_,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm"},i.a.createElement("h1",null,this.state.selectedEvent.title),i.a.createElement("h2",null,"R$ ",this.state.selectedEvent.price.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})," - ",new Date(this.state.selectedEvent.date).toLocaleDateString("pt-BR")),i.a.createElement("p",null,this.state.selectedEvent.description)),this.context.token&&i.a.createElement("div",{className:"events-control"},i.a.createElement("p",null,"Share your own Events!"),i.a.createElement("button",{className:"btn",onClick:this.startCreateEventHandler},"Create Event")),this.state.loading?i.a.createElement(S,null):i.a.createElement(x,{events:this.state.events,authUserId:this.context.userId,onViewDetail:this.showDetailHandler}))}}]),t}(a.Component));T.contextType=E;var D=T,I=(n(52),function(e){return i.a.createElement(E.Consumer,null,function(e){return i.a.createElement("header",{className:"main-navigation"},i.a.createElement("div",{className:"main-navigation__logo"},i.a.createElement("h1",null,"Event")),i.a.createElement("div",{className:"main-navigation__items"},i.a.createElement("ul",null,!e.token&&i.a.createElement("li",null,i.a.createElement(d.b,{to:"/auth"},"Authenticate")),i.a.createElement("li",null,i.a.createElement(d.b,{to:"/events"},"Events")),e.token&&i.a.createElement(i.a.Fragment,null,i.a.createElement("li",null,i.a.createElement(d.b,{to:"/bookings"},"Bookings")),i.a.createElement("li",null,i.a.createElement("button",{onClick:e.logout},"Logout"))))))})}),R=(n(61),function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={token:null,userId:null},n.login=function(e,t,a){n.setState({token:e,userId:t})},n.logout=function(){n.setState({token:null,userId:null})},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(d.a,null,i.a.createElement(i.a.Fragment,null,i.a.createElement(E.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},i.a.createElement(I,null),i.a.createElement("main",{className:"main-content"},i.a.createElement(h.d,null,this.state.token&&i.a.createElement(h.a,{from:"/",to:"/events",exact:!0}),this.state.token&&i.a.createElement(h.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&i.a.createElement(h.b,{path:"/auth",component:f}),i.a.createElement(h.b,{path:"/events",component:D}),this.state.token&&i.a.createElement(h.b,{path:"/bookings",component:N}),!this.state.token&&i.a.createElement(h.a,{to:"/auth",exact:!0}))))))}}]),t}(a.Component));o.a.render(i.a.createElement(R,null),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.2be85f70.chunk.js.map